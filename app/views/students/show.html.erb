<div class="student-show-container" data="<%=@student.id%>">

	<!-- data visualizations -->
	<div class="student-info-container">
		<div class="student-photo">
			<%= image_tag "2801ph.jpeg" %>
		</div>
		<div class="student-info">
			<h2><%= @student.lastfirst %></h2>
			 <p>Student Number: <%= @student.student_number %></p>
			 <p>Grade: <%= @student.gradelevel %></p>
		</div>
		<div class="student-donut">
			<h5>All Standards for 18-19</h5>
			<div class="student-donut-wrapper">
				<div class="student-doughnut-homs"><canvas id="student-doughnut-homs"></canvas></div>
				<div class="student-doughnut-homs"><canvas id="student-doughnut-standards"></canvas></div>
			</div>
		</div>
	</div>

	<div class="student-nav-container">
		<ul>
			<li><a class="student-comments-link" href="#">Comments</a></li>
			<li><a class="schedule-matrix-link" href='#'>Schedule Matrix</a></li>
			<li><a class="schedule-bell-link" href='#'>Bell Schedule</a></li>
			<li><a class="student-sections-link" href='#'>Sections</a></li>
			<li><a class="student-map-link" href='#'>Map Data</a></li>
			<li><%=link_to "Writing Sample", asset_path("student-writing-sample.pdf"), target: "_blank"%></li>
		</ul>
	</div>

	<div class="student-data-container">
		<!-- <canvas id="map-chart"></canvas> -->
		<%= render partial: 'comments' %>
	</div>

		
<%= content_tag :div, class: "student_list", id: "studentshow", data: {homs: @all_homs, standards: @all_standards} do %>
<%end%>



<div class="hover_bkgr_fricc">
   
</div>


<script type="text/javascript">
$(function(){

//BEGIN Global variable declarations ///////////////////////////////////////////////

	let student_id = $('.student-show-container').attr("data");
	let all_homs = $('#studentshow').data('homs');
	let all_standards = $('#studentshow').data('standards');
	let ND = all_homs.filter(function(grade){return grade.grade === "0"}).length
	let B = all_homs.filter(function(grade){return grade.grade === "1"}).length
	let P = all_homs.filter(function(grade){return grade.grade === "2"}).length
	let M = all_homs.filter(function(grade){return grade.grade === "3"}).length
	let E = all_homs.filter(function(grade){return grade.grade === "4"}).length

	let NDs = all_standards.filter(function(grade){return grade.grade === "0"}).length
	let Bs = all_standards.filter(function(grade){return grade.grade === "1"}).length
	let Ps = all_standards.filter(function(grade){return grade.grade === "2"}).length
	let Ms = all_standards.filter(function(grade){return grade.grade === "3"}).length
	let Es = all_standards.filter(function(grade){return grade.grade === "4"}).length
	
//END Global variable declarations ////////////////////////////////////////////////
//BEGIN Doughnut Standards ////////////////////////////////////////////////////////
	let doughnutDiv = $('#student-doughnut-standards');
	let dataS = {
		    datasets: [{
		        data: [NDs, Bs, Ps, Ms, Es],
		        label: "S1",
                backgroundColor: ['#FBE2E62','#A8271E', '#F8DA06', '#249D3D','#007CC6'], 
                borderColor: '#FFFFFF',
                borderWidth: 1
		    }],

		    // These labels appear in the legend and in the tooltips when hovering different arcs
		    labels: ['ND','B','P','M','E']
		};

	let doughnutChart = new Chart(doughnutDiv, {
	    type: 'doughnut',
	    data: dataS,
	    options: {
	    	legend: {
	    		position: 'right',
	    		display: true
	    	},
	    	title: {
	    		display: true,
	    		text: `Academic Standards (${all_standards.length})`,
	    		position: 'top'
	    	}

	    }
	});
// END Standards Donut /////////////////////////////////////////////////////////////

// BEGIN HOMs Donut //////////////////////////////////////////////////////////////// 
let homsDoughnutDiv = $('#student-doughnut-homs');
	let data = {
		    datasets: [{
		        data: [ND, B, P, M, E],
		        label: "S1",
                backgroundColor: ['#FBE2E62','#A8271E', '#F8DA06', '#249D3D','#007CC6'], 
                borderColor: '#FFFFFF',
                borderWidth: 1
		    }],

		    // These labels appear in the legend and in the tooltips when hovering different arcs
		    labels: ['ND','B','P','M','E']
		};

	let homsDoughnutChart = new Chart(homsDoughnutDiv, {
	    type: 'doughnut',
	    data: data,
	    options: {
	    	legend: {
	    		position: 'right',
	    		display: false
	    	},
	    	title: {
	    		display: true,
	    		text: `Habits of Mind (${all_homs.length})`,
	    		position: 'top'
	    	}

	    }
	});



// END HOMs Donut //////////////////////////////////////////////////////////////////

// BEGIN Section Charts /////////////////////////////////////////////////////////
function renderCharts(data_hash){
// Bar Chart --------------------------------------------------------------------//
	let s1_comment = data_hash["semester_comments"].filter(function(comment){return comment.semester === "S1"})
	let s2_comment = data_hash["semester_comments"].filter(function(comment){return comment.semester === "S2"})
	let course_name = data_hash["course_name"]
	let course_number = data_hash["course_number"]
	let section_number = data_hash["section_number"]
	let expression = data_hash["expression"]
	let teacher_name = data_hash["teacher"]["lastfirst"]
	let teacher_email = data_hash["teacher"]["email"]
	let s1_standard_names = data_hash["s1_standards"].map(function(e){return e.name})
	let s2_standard_names = data_hash["s2_standards"].map(function(e){return e.name})
	// s2_standard_names = s2_standard_names.map(function(name){return name.split(" ")})
	// s1_standard_names = s1_standard_names.map(function(name){return name.split(" ")})
	let s1_standard_grades = data_hash["s1_standards"].map(function(e){return e.grade})
	let s2_standard_grades = data_hash["s2_standards"].map(function(e){return e.grade})
	let s1_hom_names = data_hash["s1_homs"].map(function(e){return e.name})
	let s2_hom_names = data_hash["s2_homs"].map(function(e){return e.name})
	let s1_hom_grades = data_hash["s1_homs"].map(function(e){return e.grade})
	let s2_hom_grades = data_hash["s2_homs"].map(function(e){return e.grade})

	let notations = {
        0:"ND",
        1:"B",
        2:"P",
        3:"M",
        4:"E"
    }

    let colors = {
    	0:"#FBE2E62",
        1:"#A8271E",
        2:"#F8DA06",
        3:"#249D3D",
        4:"#007CC6"
    }

	 let html = 
	 	`<h2>${course_name}</h2>` +
	 	`<h4>${course_number}.${section_number} - ${expression}</h4>` +
	 	`<p>${teacher_name}</p>` +
	 	`<p><a href="mailto:${teacher_email}">${teacher_email}</a></p>` +
	 	'<div class="canvas-wrapper"><div class="canvas-1"><canvas id="barChartDiv"></div></canvas><div class="canvas-2"><canvas id="radarChartDiv"></canvas></div></div>';

	 	if (s1_comment[0]){
	 		html += `<a href="" class="trigger_popup_fricc" data-comment="${s1_comment[0]['content']}">S1 Comment</a>`
	 	}
	 	if (s2_comment[0]){
	 		html += `<a href="" class="trigger_popup_fricc" data-comment="${s2_comment[0]['content']}">S2 Comment</a>`;
	 	}
	 	
// BEGIN student comment popup ////////////////////////////////////////////////////////////////////
	$('.student-data-container').html(html)

	$('.hover_bkgr_fricc').html(`<span class="helper"></span><div><div class="popupCloseButton">X</div><p class="comment-text"></p></div>`)

 	$(".trigger_popup_fricc").click(function(e){
 		e.preventDefault();
 		let text = $(this).data("comment")
 		$('.comment-text').html(text + `<br><small><b>- ${teacher_name}</b></small>  ` )
   		$('.hover_bkgr_fricc').show();
    });

    $('.hover_bkgr_fricc').click(function(){
        $('.hover_bkgr_fricc').hide();
    });

    $('.popupCloseButton').click(function(){
        $('.hover_bkgr_fricc').hide();
    }); 

// END student comment popup ////////////////////////////////////////////////////////////////////

let barChartDiv = $('#barChartDiv');
let barChart = new Chart(barChartDiv, {
    type: 'horizontalBar',
    data: {
        labels: s1_standard_names,
        datasets: [{
            label: "S1",
            data: s1_standard_grades,
            backgroundColor: s1_standard_grades.map(function(grade){
            	return colors[grade]
            }), 
            borderColor: 'rgba(255,99,132,1)',
            borderWidth: 1
        },
        {
            label: "S2",
            data: s2_standard_grades,
            backgroundColor: s2_standard_grades.map(function(grade){
            	return colors[grade]
            }), 
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1

        }
    ]},
    options: {
    	responsive: true,
    	maintainAspectRatio: true,
        title: {
            display: true,
            text: "Standards"
        },
        scales: {
            xAxes: [{
                ticks:{
                    beginAtZero: true,
                    max: 4,
                    userCallback: function (value, index, values) {
                        return notations[value];
                    }
                }
            }]
        },
        layout: {
            padding: {
                left: 2,
                right: 2,
                top: 2,
                bottom: 2
            }
        }
    }
});
// Radar Chart -----------------------------------------------------------------//

	let radarChartDiv = $('#radarChartDiv');
    let radarChart = new Chart(radarChartDiv, {
        type: 'radar',
        data: {
            labels: s1_hom_names,
            datasets: [{
                label: 'S1',
                data: s1_hom_grades,
                backgroundColor: 'rgba(255,226,230, .4)',
                borderColor: 'rgba(255,99,132,1)',
                borderWidth: 1
            }
            ,{
                label: 'S2',
                data: s2_hom_grades,
                backgroundColor: 'rgba(225, 241, 255, .4)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }
        ]},
        options: {
        	responsive: true,
        	title: {
	            display: true,
	            text: `Habits of Mind`
	        },
    		maintainAspectRatio: true,
            scale: {
                ticks: {
                    beginAtZero:true,
                    max: 4,
                    userCallback: function (value, index, values) {
                        return notations[value];
                    }
                }
            },
            layout: {
	            padding: {
	                left: 2,
	                right: 2,
	                top: 2,
	                bottom: 10
	            }
	        }
        }
    });   
}
// END Section Charts ///////////////////////////////////////////////////////
// BEGIN Listener Attachments //////////////////////////////////////////////////////
	$('.schedule-matrix-link').on("click", function(event){
		event.preventDefault()
		
		$.get(`/students/${student_id}/schedule`, function(response){
			$('.student-data-container').html(response)
		})
	});

	$('.student-map-link').on("click", function(event){
		event.preventDefault();
		$.get(`/students/${student_id}/map`, function(response){
			$('.student-data-container').html(response)
		})
	})

	$('.student-sections-link').on("click", function(event){
		event.preventDefault();
		$.get(`/students/${student_id}/sections`, function(response){
			$('.student-data-container').html(response)
		}).done(function(data){
			$('.student-section-link').on("click", function(event){
				event.preventDefault();
				let section_id = $(this).attr('id')
				$.get(`/students/${student_id}/sections/${section_id}`, function(response){
					renderCharts(response);
					// console.log(response)
				})
			});
		})
	})

	$('.student-comments-link').on("click", function(event){
		event.preventDefault();
		$.get(`/students/${student_id}/comments`, function(response){
			$('.student-data-container').html(response);
		})
	})


// END Listener Attachments ///////////////////////////////////////////////
});
</script>
